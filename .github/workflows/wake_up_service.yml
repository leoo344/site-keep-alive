name: Browser Automation Wakeup
on:
  schedule:
    - cron: '*/7 * * * *' # Every 7 minutes
  workflow_dispatch:      # Manual trigger

jobs:
  fill_form_and_click:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Code
        uses: actions/checkout@v4

      - name: Set up Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'

      - name: Install Playwright
        run: |
          npm install playwright
          npx playwright install chromium --with-deps

      - name: Open Site and Fill Migration Form
        run: |
          node -e "
          const { chromium } = require('playwright');
          (async () => {
            const browser = await chromium.launch();
            const page = await browser.newPage();
            
            console.log('Navigating to RevivePass...');
            await page.goto('https://revivepass.vercel.app/', { waitUntil: 'networkidle' });
            
            await page.waitForTimeout(4000);

            try {
              // 1. Click main button
              await page.getByText('Create Migration').first().click();
              console.log('Main button clicked.');
              await page.waitForTimeout(2000);

              // 2. Fill Migration title with exactly 15 characters
              // 'MigrationTitle1' is 15 chars
              await page.getByPlaceholder('Migration title').fill('MigrationTitle1');
              console.log('Filled Title with 15 characters.');

              // 3. Fill Description with exactly 15 characters
              // 'DescriptionTxt1' is 15 chars
              await page.getByPlaceholder('Description').fill('DescriptionTxt1');
              console.log('Filled Description with 15 characters.');

              await page.waitForTimeout(1000);

              // 4. Click the final Create Migration button
              // This targets the button inside the modal/form
              await page.locator('button:has-text(\"Create Migration\")').last().click();
              console.log('Form submitted successfully!');

            } catch (e) {
              console.log('Form interaction failed, but page was touched.');
            }

            await browser.close();
          })();
          "
