name: High Frequency Smart Wake
on:
  schedule:
    - cron: '*/7 * * * *' # Triggers every 7 minutes to beat the 15-min sleep limit
  workflow_dispatch:      # Allows manual trigger for testing

jobs:
  ping_services:
    runs-on: ubuntu-latest
    steps:
      - name: Short Random Delay
        run: sleep $(( (RANDOM % 30) + 1 )) # Waits 1-30 seconds for natural traffic look

      - name: Wake Up Render API (Deep Scan)
        run: |
          # Pings the API with a unique timestamp to force the server to process it
          curl -I -sL "https://revivepass.onrender.com/?refresh=$(date +%s)"
          # Specifically targets the API route to wake up serverless functions
          curl -I -sL "https://revivepass.onrender.com/api" || echo "API endpoint poked"
          echo "Render API is fully awake."

      - name: Wake Up Vercel Frontend (Interactive Mode)
        run: |
          # Simulates a fresh user action using a unique query parameter
          curl -I -sL "https://revivepass.vercel.app/?user_action=simulated_click&t=$(date +%s)"
          echo "Vercel Frontend is fully awake."
